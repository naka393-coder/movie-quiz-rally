<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>THE ISLAND ARCHIVES</title>
    <!-- フォント読み込み -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Abril+Fatface&family=Cinzel:wght@400;700&family=Playfair+Display:ital,wght@0,400;0,700;1,400&family=Shippori+Mincho:wght@400;500;700&family=UnifrakturMaguntia&family=Special+Elite&family=Noto+Serif+JP:wght@300;500;700&family=Yuji+Syuku&display=swap" rel="stylesheet">

    <style>
        /* --- 全要素のボックスサイズ計算を統一してはみ出し防止 --- */
        * {
            box-sizing: border-box;
        }

        :root {
            --text-color: #e0e0e0;
            --paper-bg: #e3decb;
            --note-bg: #fdfbf7;
            --map-bg: #d8cfb4;
            --ink-color: #1a1a1a;
        }

        body, html {
            margin: 0;
            padding: 0;
            width: 100%;
            height: auto;
            min-height: 100dvh;
            overflow-x: hidden;
            background-color: #050505;
            color: var(--text-color);
            font-family: 'Shippori Mincho', serif;
        }

        /* --- 0. オープニングモーダル --- */
        #opening-modal-overlay {
            position: fixed;
            top: 0; left: 0; width: 100%; height: 100%;
            z-index: 9999; /* 確実に最前面へ */
            background: #000000;
            display: flex; justify-content: center; align-items: center;
            opacity: 1;
            animation: fadeInOverlay 1s ease forwards;
        }

        .opening-card {
            width: min(600px, 90vw);
            padding: 40px 20px;
            color: #fff;
            font-family: 'Shippori Mincho', serif;
            text-align: center;
            line-height: 2.2;
            font-size: 1.1rem;
            opacity: 0;
            animation: fadeInText 2s ease 0.5s forwards;
        }

        .start-btn {
            margin-top: 40px;
            background: transparent;
            border: 1px solid rgba(255,255,255,0.4);
            color: rgba(255,255,255,0.8);
            padding: 12px 40px;
            font-family: 'Cinzel', serif;
            font-size: 0.9rem;
            cursor: pointer;
            transition: all 0.5s;
            letter-spacing: 0.1em;
        }
        .start-btn:hover {
            background: rgba(255,255,255,0.1); border-color: #fff; color: #fff;
            box-shadow: 0 0 15px rgba(255,255,255,0.3);
        }

        /* --- 背景画像レイヤー --- */
        #bg-image {
            position: fixed;
            top: 0; left: 0; width: 100%; height: 100vh;
            z-index: 0;
            background-image: url('https://i.imgur.com/VW2f0Oy.jpeg');
            background-size: cover;
            background-position: center;
            background-repeat: no-repeat;
            filter: brightness(0.5) contrast(1.1);
        }

        /* --- Canvasレイヤー --- */
        #world {
            position: fixed;
            top: 0; left: 0; width: 100%; height: 100%;
            z-index: 1;
            pointer-events: none;
        }

        /* --- 共通: スクラップアイテム --- */
        .scrap-item {
            position: relative;
            z-index: 10;
            margin: 40px auto;
            box-shadow: 0 10px 30px rgba(0,0,0,0.5);
            transition: transform 0.3s ease, filter 0.3s ease;
            cursor: pointer;
            max-width: 900px;
            width: 95%;
        }
        .scrap-item:hover {
            transform: scale(1.02) !important;
            z-index: 15;
            filter: brightness(1.1);
        }

        /* --- 1. ヒーローエリア --- */
        #hero-section {
            position: relative;
            z-index: 10;
            width: 100%;
            min-height: 100vh;
            padding: 60px 20px;
            display: flex; flex-direction: column; justify-content: center; align-items: center;
            background: radial-gradient(circle at center, transparent 20%, rgba(5,5,5,0.9) 90%);
        }

        h1.main-title {
            font-family: 'Abril Fatface', cursive;
            font-size: clamp(2.5rem, 10vw, 7rem);
            letter-spacing: 0.1em;
            margin: 0;
            color: #ffffff;
            text-shadow: 0 0 20px rgba(255, 255, 255, 0.5);
            opacity: 0;
            animation: textFadeIn 3s ease forwards 1s;
            text-align: center;
            line-height: 1.1;
        }

        p.sub-title {
            font-family: 'Cinzel', serif;
            font-size: clamp(0.9rem, 3vw, 1.2rem);
            letter-spacing: 0.2em;
            color: rgba(255, 255, 255, 0.8);
            margin-bottom: 3rem;
            text-transform: uppercase;
            opacity: 0;
            animation: textFadeIn 3s ease forwards 2s;
            text-align: center;
        }

        /* 導入メッセージ */
        .intro-card {
            width: min(600px, 90vw);
            background: rgba(20, 20, 25, 0.8);
            border: 1px solid rgba(255, 255, 255, 0.2);
            padding: 2rem;
            color: #dcdcdc;
            line-height: 1.8;
            font-family: 'Shippori Mincho', serif;
            box-shadow: 0 0 50px rgba(0,0,0,0.8);
            opacity: 0;
            animation: slideUp 2s ease forwards 2.5s;
            position: relative;
            font-size: 0.95rem;
        }
        .intro-card::before {
            content: ''; position: absolute; left: 10px; top: 10px; bottom: 10px;
            width: 2px; background: rgba(255,255,255,0.1);
        }

        .scroll-indicator { margin-top: 40px; margin-bottom: 20px; color: rgba(255,255,255,0.8); font-family: 'Cinzel', serif; font-size: 0.9rem; letter-spacing: 0.2em; animation: bounce 2s infinite; }

        /* --- 2. 新聞記事セクション --- */
        #newspaper-section {
            position: relative;
            z-index: 20;
            width: 100%;
            padding: 40px 15px;
            background-image: url('https://i.imgur.com/98BKXgT.jpeg');
            background-size: cover; background-position: center; background-attachment: fixed;
        }
        #newspaper-section::after {
            content: ''; position: absolute; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0, 0, 0, 0.5); pointer-events: none; z-index: 0;
        }

        .newspaper-paper {
            background-color: var(--paper-bg); color: var(--ink-color);
            padding: 40px; transform: rotate(-1deg);
            background-image: url("data:image/svg+xml,%3Csvg viewBox='0 0 200 200' xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='n'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.8' numOctaves='3' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='100%25' height='100%25' filter='url(%23n)' opacity='0.05'/%3E%3C/svg%3E");
        }
        .newspaper-inner-border { border: 1px solid var(--ink-color); padding: 30px; height: 100%; position: relative; }
        .newspaper-inner-border::before { content: ''; position: absolute; top: 4px; left: 4px; right: 4px; bottom: 4px; border: 1px solid var(--ink-color); pointer-events: none; }
        
        .paper-header { text-align: center; margin-bottom: 30px; padding-bottom: 20px; }
        .paper-masthead {
            font-family: 'UnifrakturMaguntia', cursive; font-size: clamp(3rem, 10vw, 5rem);
            line-height: 1; width: 100%; text-align: center; margin-bottom: 10px; color: #111;
        }
        .paper-meta-info {
            display: flex; justify-content: space-between; align-items: center;
            font-family: 'Cinzel', serif; font-size: 0.9rem; text-transform: uppercase; letter-spacing: 0.1em;
            border-top: 1px solid var(--ink-color); border-bottom: 4px double var(--ink-color);
            padding: 8px 0; margin-bottom: 25px; font-weight: 700; color: #333;
        }
        .paper-title { 
            font-family: 'Playfair Display', serif; font-size: clamp(3rem, 8vw, 5.5rem); line-height: 0.9;
            margin: 20px 0 15px 0; font-weight: 700; text-transform: uppercase; text-align: center;
        }
        .paper-subtitle { font-family: 'Shippori Mincho', serif; font-size: 1.1rem; font-weight: 700; margin-top: 10px; font-style: italic; text-align: center; }
        
        .article-body { 
            column-count: 3; column-gap: 30px; column-rule: 1px solid rgba(0,0,0,0.2);
            font-family: 'Shippori Mincho', serif; font-size: 0.95rem; line-height: 1.8; text-align: justify;
        }
        .article-body p { margin: 0 0 1em 0; }
        .article-body p:not(:first-of-type) { text-indent: 1em; }
        
        .drop-cap { float: left; font-family: 'UnifrakturMaguntia', cursive; font-size: 4.5rem; line-height: 0.8; padding-top: 5px; padding-right: 12px; font-weight: 400; color: #000; }
        .highlight-quote { 
            font-family: 'Shippori Mincho', serif; font-size: 1.2rem; line-height: 1.6; font-weight: 700;
            border-top: 2px solid var(--ink-color); border-bottom: 2px solid var(--ink-color);
            padding: 20px 0; margin: 20px 0; text-align: center; background: rgba(0,0,0,0.03); text-indent: 0 !important; break-inside: avoid;
        }

        /* スマホ対応 */
        @media (max-width: 900px) { 
            .article-body { column-count: 2; } 
            .newspaper-paper { padding: 25px; transform: rotate(0deg) !important; margin: 40px auto; width: 100%; } 
            .newspaper-inner-border { padding: 15px; }
        }
        @media (max-width: 600px) { 
            .article-body { column-count: 1; column-rule: none; } 
            .paper-meta-info { flex-direction: column; gap: 5px; font-size: 0.8rem; }
            .scrap-item { margin: 30px auto; }
        }

        /* --- 3. 調査ボードセクション --- */
        #investigation-board {
            position: relative; z-index: 20; width: 100%; padding: 60px 20px;
            background-image: url('https://i.imgur.com/y2coIA5.jpeg');
            background-size: cover; background-position: center; background-attachment: fixed;
            display: flex; justify-content: center; flex-wrap: wrap; gap: 40px;
        }
        #investigation-board::after {
            content: ''; position: absolute; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0, 0, 0, 0.4); pointer-events: none; z-index: 0;
        }

        .investigation-note {
            width: min(500px, 100%); background-color: var(--note-bg); color: #333;
            padding: 30px; font-family: 'Special Elite', cursive; font-size: 1rem; line-height: 1.6;
            box-shadow: 5px 5px 15px rgba(0,0,0,0.5); position: relative; z-index: 1;
        }
        .investigation-note::before {
            content: ''; position: absolute; top: -15px; left: 50%; transform: translateX(-50%);
            width: 120px; height: 35px; background: rgba(255, 255, 255, 0.3);
            border: 1px solid rgba(255,255,255,0.2); box-shadow: 0 1px 3px rgba(0,0,0,0.1);
        }
        .note-title { font-weight: bold; border-bottom: 2px solid #333; margin-bottom: 15px; padding-bottom: 5px; text-transform: uppercase; letter-spacing: 0.1em; word-wrap: break-word; }
        .stamp-mark { position: absolute; bottom: 20px; right: 20px; border: 3px solid #c00; color: #c00; padding: 5px 10px; font-weight: bold; font-size: 1.2rem; transform: rotate(-15deg); opacity: 0.7; pointer-events: none; }

        @media (max-width: 600px) {
            .investigation-note { transform: rotate(0deg) !important; padding: 20px; margin-top: 20px !important; }
        }

        /* --- 4. 地図 --- */
        #map-section {
            position: relative; z-index: 20; width: 100%; padding: 60px 15px; display: flex; justify-content: center;
        }
        .old-map {
            width: min(700px, 100%); background-color: var(--map-bg); padding: 20px;
            border: 8px solid #5a4a3a; box-shadow: 0 20px 50px rgba(0,0,0,0.8); transform: rotate(0.5deg);
        }
        .map-svg { width: 100%; height: auto; border: 1px solid #8b7355; background: #eaddcf; }
        .map-label { text-align: center; font-family: 'UnifrakturMaguntia', cursive; font-size: 2rem; margin-top: 10px; color: #3e3226; }
        @media (max-width: 600px) { .old-map { transform: rotate(0deg) !important; padding: 10px; border-width: 4px; } }

        /* --- 5. 最下部イラスト --- */
        #footer-scene {
            position: relative; z-index: 20; width: 100%; 
            padding: 80px 20px 40px;
            background-color: #08080a; 
            background-image: url('https://i.imgur.com/2QZQVmX.jpeg');
            background-size: cover; background-position: center;
            display: flex; flex-direction: column; justify-content: center; align-items: center;
            overflow: hidden; border-top: 1px solid #222;
        }
        #footer-scene::after {
            content: ''; position: absolute; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0, 0, 0, 0.7); pointer-events: none; z-index: 0;
        }

        .painting-frame {
            position: relative; z-index: 1; width: min(800px, 100%); aspect-ratio: 16/9;
            border: 15px solid #3e3025; 
            box-shadow: inset 0 0 20px rgba(0,0,0,0.8), 0 0 0 2px #1a1510, 0 0 0 6px #5a4a3a, 0 20px 60px rgba(0,0,0,0.9);
            background: #000; overflow: hidden; transform: rotate(0.5deg);
        }
        .painting-frame::before {
            content: ''; position: absolute; top: 0; left: 0; width: 100%; height: 100%;
            background-image: url("data:image/svg+xml,%3Csvg viewBox='0 0 200 200' xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='noise'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.65' numOctaves='3' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='100%25' height='100%25' filter='url(%23noise)' opacity='0.1'/%3E%3C/svg%3E");
            pointer-events: none; z-index: 5; mix-blend-mode: overlay;
        }
        .painting-inner-border {
            position: absolute; top: 0; left: 0; right: 0; bottom: 0;
            border: 4px solid #8a7b6b; pointer-events: none; z-index: 6;
        }
        .scene-svg { width: 100%; height: 100%; display: block; }

        .painting-caption {
            position: relative; z-index: 1; margin-top: 25px;
            font-family: 'Special Elite', cursive; color: #aaa; font-size: 0.8rem;
            text-align: center; background: #111; padding: 8px 15px; border: 1px solid #333;
            box-shadow: 0 2px 5px rgba(0,0,0,0.5); max-width: 300px;
        }

        .footer-credit { 
            margin-top: 30px; font-family: 'Cinzel', serif; font-size: 0.6rem; 
            color: rgba(255,255,255,0.15); letter-spacing: 0.2em; position: relative; z-index: 5;
        }

        .interactive { pointer-events: auto; }
        
        #secret-moon { cursor: pointer; transition: opacity 0.3s; }
        #secret-moon:hover { opacity: 0.8; filter: drop-shadow(0 0 10px white); }
        .moon-active { filter: drop-shadow(0 0 20px #fff) drop-shadow(0 0 40px #ff9) !important; transition: filter 1s ease; }

        /* --- 6. 古文書オーバーレイ --- */
        #ancient-document-overlay {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%; z-index: 1000;
            background: rgba(0, 0, 0, 0.95);
            display: flex; flex-direction: column; justify-content: center; align-items: center; gap: 20px;
            opacity: 0; pointer-events: none; transition: opacity 1s ease;
        }
        #ancient-document-overlay.active { opacity: 1; pointer-events: auto; }

        .overlay-guide-message {
            color: #e0e0e0; font-family: 'Shippori Mincho', serif; text-align: center;
            line-height: 1.8; font-size: 1.1rem; max-width: 90%;
            text-shadow: 0 0 10px rgba(255, 255, 255, 0.3);
            animation: fadeInText 2s ease 0.5s forwards; opacity: 0;
        }

        /* 羊皮紙のコンテナ（影と形状） */
        .ancient-scroll-wrapper {
            position: relative;
            width: min(800px, 95vw);
            max-height: 75vh;
            filter: drop-shadow(10px 10px 20px rgba(0,0,0,0.8));
            animation: slideUp 0.5s ease-out;
        }

        /* 古文書のデザイン（ヴィンテージ風・クリップパス） */
        .ancient-scroll {
            width: 100%; height: 100%;
            min-height: 60vh;
            overflow: auto;
            
            /* ベースカラーとテクスチャ */
            background-color: #e3d6b1; 
            background-image: 
                url("data:image/svg+xml,%3Csvg viewBox='0 0 200 200' xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='n'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.5' numOctaves='5' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='100%25' height='100%25' filter='url(%23n)' opacity='0.3'/%3E%3C/svg%3E"),
                radial-gradient(circle at 50% 50%, transparent 60%, rgba(101, 67, 33, 0.2) 100%),
                linear-gradient(225deg, transparent 20px, rgba(0,0,0,0.1) 20px, transparent 30px);

            padding: 60px 50px;
            
            /* ギザギザの切り抜き */
            clip-path: polygon(
                2% 5%, 5% 2%, 10% 4%, 20% 1%, 30% 3%, 40% 1%, 50% 4%, 60% 2%, 70% 5%, 80% 2%, 90% 4%, 95% 0%, 
                100% 5%, 98% 15%, 99% 25%, 97% 35%, 99% 45%, 96% 55%, 98% 65%, 97% 75%, 99% 85%, 96% 95%, 
                95% 100%, 85% 97%, 75% 99%, 65% 96%, 55% 98%, 45% 96%, 35% 99%, 25% 97%, 15% 99%, 5% 96%, 
                2% 90%, 4% 80%, 1% 70%, 3% 60%, 1% 50%, 4% 40%, 1% 30%, 3% 20%, 1% 10%
            );

            position: relative;
            font-family: 'Yuji Syuku', serif; color: #3e2b20;
            display: flex; flex-direction: column; align-items: center;
        }

        /* 右上の折れ耳 */
        .ancient-scroll::after {
            content: ''; position: absolute; top: 0; right: 0;
            width: 50px; height: 50px;
            background: linear-gradient(to bottom left, #d1c2a3 50%, transparent 50%);
            z-index: 10; pointer-events: none;
        }

        .ancient-header {
            width: 100%; text-align: center; border-bottom: 2px solid #8b7355;
            margin-bottom: 30px; padding-bottom: 10px; position: relative;
        }
        .ancient-title {
            font-size: 1.8rem; font-weight: 700; color: #5a2a2a; letter-spacing: 0.2em;
            text-shadow: 1px 1px 0px rgba(255,255,255,0.2);
        }

        .ancient-grid-text {
            writing-mode: vertical-rl; text-orientation: upright;
            font-size: 1.1rem; line-height: 2.5em; letter-spacing: 0.8em; 
            font-feature-settings: "palt" 0; font-variant-east-asian: full-width;
            margin: 0 auto; font-weight: 500; white-space: pre; 
            color: #2c1b10; position: relative; width: fit-content;
            text-shadow: 0 0 2px rgba(62, 43, 32, 0.2);
        }

        @media (max-width: 768px) {
            .ancient-grid-text { font-size: 0.9rem; letter-spacing: 0.5em; line-height: 1.6em; }
            .ancient-scroll { padding: 40px 30px; min-height: 50vh; }
            .ancient-title { font-size: 1.4rem; }
        }

        /* --- 7. 詳細拡大用オーバーレイ --- */
        #detail-modal-overlay {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%; z-index: 2000;
            background: rgba(0, 0, 0, 0.9);
            display: flex; justify-content: center; align-items: center;
            opacity: 0; pointer-events: none; transition: opacity 0.3s ease;
        }
        #detail-modal-overlay.active { opacity: 1; pointer-events: auto; }
        
        #detail-content-area {
            max-width: 95vw; max-height: 95vh; overflow: auto;
            display: flex; justify-content: center; align-items: center; padding: 20px;
        }
        #detail-content-area .scrap-item {
            margin: 0 !important; transform: none !important; box-shadow: 0 0 50px rgba(0,0,0,0.8);
            cursor: default; max-width: 800px; width: 100%;
        }
        #detail-content-area .scrap-item:hover { transform: none !important; }

        .close-btn {
            position: fixed; top: 30px; right: 30px; z-index: 2010;
            background: rgba(255, 255, 255, 0.1); border: 1px solid rgba(255, 255, 255, 0.3);
            color: #fff; padding: 10px 20px; font-family: 'Cinzel', serif; font-size: 1rem;
            cursor: pointer; opacity: 0.8; transition: all 0.3s; border-radius: 4px;
        }
        .close-btn:hover { opacity: 1; background: rgba(255, 255, 255, 0.2); }

        /* --- 8. ホワイトアウト演出 --- */
        #flash-effect {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: white; z-index: 2500; opacity: 0; pointer-events: none;
            transition: opacity 1.5s ease-in-out;
        }

        @keyframes fadeInOverlay { from { opacity: 0; } to { opacity: 1; } }
        @keyframes fadeInText { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        @keyframes textFadeIn { to { opacity: 1; } }
        @keyframes slideUp { to { opacity: 1; transform: translateY(0); } }
        @keyframes bounce { 0%, 20%, 50%, 80%, 100% {transform: translateY(0);} 40% {transform: translateY(-10px);} 60% {transform: translateY(-5px);} }
    </style>
</head>
<body>

    <div id="bg-image"></div>
    <canvas id="world"></canvas>

    <!-- 0. オープニングモーダル -->
    <div id="opening-modal-overlay">
        <div class="opening-card">
            <p>マスターから渡された本を開くと<span style="display: inline-block; width: 4rem; height: 1px; background-color: #fff; vertical-align: middle; margin-left: 0.5rem;"></span></p>
            <p>この島の調査資料だった。<br>この本の内容を調べて、島の真実にたどり着こう。</p>
            <!-- IDを追加してJSで制御 -->
            <button class="start-btn" id="opening-start-btn">調査を開始する</button>
        </div>
    </div>

    <!-- 1. 表紙 -->
    <div id="hero-section">
        <h1 class="main-title">THE ISLAND ARCHIVES</h1>
        <p class="sub-title">100 Years of Silence / Incident File No.1024</p>
        <div class="intro-card">
            <p style="font-weight:bold; margin-bottom: 1.5em; font-size: 1.2em;">この本を手にした君へ</p>
            <p>私は長年、この島で起きた忌まわしい事件の秘密を調査している。</p>
            <p>膨大な資料を集め、あと少しで真相に手が届きそうなのだが……最後のピースだけがどうしても見つからない。</p>
            <p>調査によると、この島のどこかに隠された<span style="border-bottom: 1px solid rgba(255,255,255,0.5);">「古文書」</span>が存在するらしい。それを見つけることができれば、真実にたどり着けるはずだ。</p>
            <p>私が残したこの調査資料が、君の助けになることを願う。</p>
            <p style="text-align: right; margin-top: 1.5em; font-style: italic; opacity: 0.7;">―― ある調査員の記録より</p>
        </div>
        <div class="scroll-indicator">SCROLL TO OPEN</div>
    </div>

    <!-- 2. 新聞記事 -->
    <section id="newspaper-section">
        <div class="newspaper-paper scrap-item" onclick="openDetailModal(this)">
            <div class="newspaper-inner-border">
                <div class="paper-header">
                    <div class="paper-masthead">The Island Chronicle</div>
                    <div class="paper-meta-info">
                        <span>October, 1592</span>
                        <span>Price: 50c</span>
                    </div>
                    <h2 class="paper-title">THE LOST MEMORY</h2>
                    <h3 class="paper-subtitle">100年の時を超え、灯台の地下より発見された不可解な記録。</h3>
                </div>
                <div class="article-body">
                    <p><span class="drop-cap">こ</span>の島で忌まわしい事件が起きてから、およそ1世紀が過ぎようとしている。我々島民にとって、あの岬の灯台は「近寄ってはならない場所」として語り継がれてきた。しかし、先日の大規模な修復工事の際、瓦礫の下から古い鉄製の箱が発見されたことで、封印された過去が再び光の下に晒されることとなった。</p>
                    <p>箱の中に収められていたのは、当時の灯台守が記したと思われる数冊の日記である。湿気とカビで大部分は判読不能となっていたが、残された断片からは、孤独な任務の中で徐々に正気を失っていく男の凄惨な記録が読み取れる。彼は「光」に何かを見ていたようだ。</p>
                    <div class="highlight-quote">門からはじまる下り坂<br>歩き出したら一直線<br>先の鏡で跳ね返り<br>旅の軌道を合わすべし</div>
                    <p>日記の最後のページには、震える文字で上記の詩が走り書きされていた。この詩が何を意味するのか、現在のところ解読できた者はいない。島の古老たちも首をかしげるばかりだ。</p>
                    <p>「門」とは何か。「下り坂」とは物理的な場所なのか、それとも精神的な墜落を指すのか。「先の鏡」という言葉が示唆する超常的な響きに、調査団の間でも動揺が広がっている。</p>
                    <p>確かなことは一つだけある。100年前のあの日、灯台で何かが起きた。そしてその真実は、我々が想像するよりも遥かに不可解で、恐ろしいものだったのかもしれない。発見された詩は、過去からの警告なのだろうか。それとも、まだ終わっていない旅への招待状なのだろうか。</p>
                </div>
            </div>
        </div>
    </section>

    <!-- 3. 調査ボード -->
    <section id="investigation-board">
        <!-- メモ1 -->
        <div class="investigation-note scrap-item" onclick="openDetailModal(this)">
            <div class="note-title">EVIDENCE A: RESIDENT TESTIMONY</div>
            <p>証言者：漁師の老人 (当時8歳)</p>
            <p>「嵐の夜だった。海が真っ黒で、灯台の光だけが狂ったように回っていたんだ。光が村を照らすたびに、影が動いているように見えた。人の形をした影じゃない。もっと長くて、うねるような…」</p>
            <p>「次の日の朝、灯台守はいなくなっていた。食卓には温かいスープが残されたままでな。」</p>
            <p style="margin-top: 1em; border-top: 1px dashed #666; padding-top: 1em;">「そういえば婆様がよく歌っていたな。『灯台の光が指し示す先を三度たたけば真実に近づく』…あれはただの子守唄じゃなかったのかもしれん。」</p>
            <div class="stamp-mark">RECORDED</div>
        </div>
        <!-- メモ2 -->
        <div class="investigation-note scrap-item" style="transform: rotate(-2deg); margin-top:50px;" onclick="openDetailModal(this)">
            <div class="note-title">REPORT: SITE ANALYSIS</div>
            <p>現場検証報告：灯台最上階</p>
            <p>ランタン室のガラスには内側から無数の傷がついていた。鳥がぶつかった跡ではない。何かが中から外へ出ようとして暴れた痕跡に見える。</p>
            <p>壁には爪で刻んだような跡で、繰り返し「LOOK UP (上を見ろ)」と記されていた。</p>
            <div class="stamp-mark">CONFIDENTIAL</div>
        </div>
        <!-- メモ3 -->
        <div class="investigation-note scrap-item" style="transform: rotate(1deg); background-color: #f2efe4;" onclick="openDetailModal(this)">
            <div class="note-title">TRANSCRIPT: TAPE #084</div>
            <p style="font-size: 0.85rem; color: #666; margin-bottom: 10px;">[Interview with an old storyteller at the bar]</p>
            <p><strong>調査員:</strong> この島に眠るという『古文書』……どうしても見つからないんだ。</p>
            <p><strong>老人:</strong> 焦ることはない。だが覚えておけ。その書は目だけで読むものではないそうじゃ。</p>
            <p><strong>調査員:</strong> どういうことだ？</p>
            <p><strong>老人:</strong> 筆者はこの「詩」を聞きながら古文書を書いたと言われておる。</p>
            <p><strong>老人:</strong> もし書を見つけたなら、その詩を思い出せ。始まりさえ合わせれば、道はおのずと見えてくるはずじゃ…。</p>
            <div class="stamp-mark" style="border-color: #333; color: #333; transform: rotate(10deg);">IMPORTANT</div>
        </div>
        <!-- メモ4 -->
        <div class="investigation-note scrap-item" style="transform: rotate(-1.5deg); width: min(400px, 100%);" onclick="openDetailModal(this)">
            <div class="note-title">OBSERVATION LOG</div>
            <p>灯台の光の明滅パターンを解析中。現在の回転周期は12.4秒。100年前の設計図にある12.0秒とわずかにズレている。</p>
            <p>ただの経年劣化か？それとも誰かが意図的にリズムを変えたのか？</p>
        </div>
        <!-- メモ5 -->
        <div class="investigation-note scrap-item" style="transform: rotate(2deg); width: min(450px, 100%);" onclick="openDetailModal(this)">
            <div class="note-title">UNIDENTIFIED OBJECT</div>
            <p>海岸で奇妙な金属片を回収した。酷く錆びついているが、現代の技術で作られた合金には見えない。</p>
            <p>島に伝わる「鉄騎兵」の伝説に関係する鎧の一部だろうか？炭素年代測定の結果を待つ。</p>
            <div class="stamp-mark" style="border-color: #8b0000; color: #8b0000;">PENDING</div>
        </div>
    </section>

    <!-- 4. 地図 -->
    <section id="map-section">
        <div class="old-map scrap-item" onclick="openDetailModal(this)">
            <h3 class="map-label">Sketch of the Cape (Circa 2024)</h3>
            <svg class="map-svg" viewBox="0 0 600 400" preserveAspectRatio="xMidYMid meet">
                <defs>
                    <filter id="pencil">
                        <feTurbulence type="fractalNoise" baseFrequency="0.9" numOctaves="3" result="noise"/>
                        <feDisplacementMap in="SourceGraphic" in2="noise" scale="2" />
                    </filter>
                </defs>
                <rect width="600" height="400" fill="#d0dce3" opacity="0.3"/>
                <path d="M 50 400 L 50 200 Q 80 150 150 150 Q 250 150 300 100 Q 350 50 450 50 Q 550 50 580 100 L 600 120 L 600 400 Z" fill="#eaddcf" stroke="#5a4a3a" stroke-width="2" filter="url(#pencil)"/>
                <path d="M 100 400 Q 150 300 300 250 Q 450 200 550 150" fill="none" stroke="#5a4a3a" stroke-width="1" stroke-dasharray="5,5" opacity="0.5"/>
                <path d="M 100 350 Q 130 300 180 320 Q 220 350 200 380 Z" fill="#c4d6b6" stroke="#5a4a3a" opacity="0.6"/>
                <text x="140" y="360" font-family="'Special Elite', serif" font-size="12" fill="#333">DEEP FOREST</text>
                <rect x="350" y="300" width="10" height="10" fill="#333"/>
                <rect x="370" y="290" width="10" height="10" fill="#333"/>
                <rect x="360" y="315" width="10" height="10" fill="#333"/>
                <text x="350" y="340" font-family="'Special Elite', serif" font-size="12" fill="#333">VILLAGE</text>
                <line x1="500" y1="80" x2="520" y2="100" stroke="#c00" stroke-width="3"/>
                <line x1="520" y1="80" x2="500" y2="100" stroke="#c00" stroke-width="3"/>
                <circle cx="510" cy="90" r="15" stroke="#c00" stroke-width="2" fill="none"/>
                <text x="480" y="70" font-family="'Special Elite', serif" font-size="14" fill="#c00" font-weight="bold">LIGHTHOUSE</text>
                <path d="M 360 300 Q 350 200 500 100" fill="none" stroke="#5a4a3a" stroke-width="2" stroke-dasharray="10,5"/>
            </svg>
        </div>
    </section>

    <!-- 5. 最下部イラスト -->
    <section id="footer-scene">
        <div class="painting-frame">
            <div class="painting-inner-border"></div>
            <svg class="scene-svg" viewBox="0 0 800 500" preserveAspectRatio="xMidYMax slice">
                <defs>
                    <linearGradient id="beamGradient" x1="0%" y1="100%" x2="100%" y2="0%">
                        <stop offset="0%" style="stop-color:rgba(255, 255, 255, 0.5);stop-opacity:1" />
                        <stop offset="70%" style="stop-color:rgba(255, 255, 255, 0.1);stop-opacity:0.3" />
                        <stop offset="100%" style="stop-color:rgba(255, 255, 255, 0);stop-opacity:0" />
                    </linearGradient>
                    <filter id="moonGlow">
                        <feGaussianBlur stdDeviation="4" result="coloredBlur"/>
                        <feMerge>
                            <feMergeNode in="coloredBlur"/>
                            <feMergeNode in="SourceGraphic"/>
                        </feMerge>
                    </filter>
                </defs>
                <circle cx="300" cy="80" r="1.5" fill="white" opacity="0.8" />
                <circle cx="500" cy="100" r="1" fill="white" opacity="0.9" />
                <circle cx="200" cy="200" r="1.2" fill="white" opacity="0.6" />
                <circle cx="600" cy="80" r="0.8" fill="white" opacity="0.8" />
                <path d="M210 420 L 370 150 L 430 150 L 230 420 Z" fill="url(#beamGradient)" style="mix-blend-mode: screen;" />
                <path id="secret-moon" d="M 400 100 A 50 50 0 1 1 400 200 A 65 65 0 0 0 400 100 Z" fill="#ffffff" filter="url(#moonGlow)" opacity="1"/>
                <path d="M180 500 L 260 500 L 240 420 L 200 420 Z" fill="#f0f0f0" />
                <rect x="195" y="415" width="50" height="8" fill="#f0f0f0" />
                <rect x="205" y="400" width="30" height="15" fill="#ffffff" />
                <path d="M200 400 L 240 400 L 220 380 Z" fill="#f0f0f0" />
                <path d="M-10 505 L 810 505 L 810 480 Q 600 450 400 480 Q 200 500 -10 470 Z" fill="#d0d0d0" />
            </svg>
        </div>
        <div class="painting-caption">
            <span style="display:block; font-size: 0.8em; opacity: 0.7; margin-bottom: 4px;">資料番号: 01-A</span>
            遺跡の最深部で発見された油彩画。<br>
            描かれた灯台は、現存するものとは形状が異なっている。<br>
            裏面には「1554年」の日付と共に「プロフェット」の署名が残されている。
        </div>

        <!-- 謎の少女 -->
        <div class="scrap-item" onclick="openDetailModal(this)" style="background: #111; padding: 15px; border: 1px solid #444; width: min(500px, 95vw); transform: rotate(-1deg); margin-top: 80px; margin-bottom: 20px;">
            <img src="https://i.imgur.com/5WwRqsR.jpeg" alt="Mysterious Girl" style="width: 100%; height: auto; display: block; filter: sepia(0.3) contrast(1.1);">
            <div style="margin-top: 15px; font-family: 'Shippori Mincho', serif; color: #ccc; text-align: center; font-size: 0.9rem;">
                <span style="border-bottom: 1px solid #666; padding-bottom: 5px;">資料番号: 99-X</span><br><br>
                海岸に打ち上げられた木箱に入っていた少女の肖像。<br>
                彼女の瞳は、何かを訴えかけているようだ。<br>
                島民の誰も彼女のことを知らない。
            </div>
        </div>
        <!-- 王様の肖像 -->
        <div class="scrap-item" onclick="openDetailModal(this)" style="background: #1a1510; padding: 20px; border: 4px double #8a7b6b; width: min(500px, 95vw); transform: rotate(1.5deg); margin-top: 60px; margin-bottom: 40px; box-shadow: 0 10px 40px rgba(0,0,0,0.8);">
            <!-- ImgurのページURLから画像直リンク形式(.jpeg)に補正して使用 -->
            <img src="https://i.imgur.com/yUc9BV9.jpeg" alt="King Portrait" style="width: 100%; height: auto; display: block; filter: sepia(0.2) contrast(1.05);">
            <div style="margin-top: 15px; font-family: 'Shippori Mincho', serif; color: #dcd0ba; text-align: center; font-size: 0.9rem; line-height: 1.8;">
                <span style="border-bottom: 1px solid #8a7b6b; padding-bottom: 5px; font-family: 'Cinzel', serif; letter-spacing: 0.1em; color: #c0a060;">THE LOCAL RULER</span><br><br>
                現在この周辺地域を統治している王の肖像画。<br>
                威厳ある姿で描かれている。<br>
                私は一度だけお見かけしたことがあるが、<br>噂通りの慈愛に満ちた眼差しをしておられた。
            </div>
        </div>

        <div class="footer-credit">© 2024 LIGHTHOUSE PROJECT</div>
    </section>

    <!-- 6. 古文書オーバーレイ -->
    <div id="ancient-document-overlay">
        <div class="overlay-guide-message">
            <p>三日月が呼応するように輝き、封印されていた記録が浮かび上がった。<br>ここに真実の在処に関するヒントが記されているはずだが……</p>
        </div>
        <button class="close-btn" onclick="closeOverlay()">✕ CLOSE</button>
        
        <!-- 羊皮紙コンテナ -->
        <div class="ancient-scroll-wrapper">
            <div class="ancient-scroll">
                <div class="ancient-header">
                    <span class="ancient-title">【灯台守ノ遺文・断片】</span>
                </div>
                <div class="ancient-grid-text">
地獄門の前で立ち止まりけり
三度の番人を呼びて扉をあけ
闇夜の影が深まりし刻実を見
掟を固く見守り抜く真理の道
静かに深く眠る海に光満ちて
遥かなる夢の行先を照らす火</div>
            </div>
        </div>
    </div>

    <!-- 7. 詳細拡大用オーバーレイ -->
    <div id="detail-modal-overlay">
        <button class="close-btn" onclick="closeDetailModal()">✕ CLOSE</button>
        <div id="detail-content-area"></div>
    </div>

    <!-- 8. ホワイトアウト演出 -->
    <div id="flash-effect"></div>

    <script>
        // オープニングモーダルを閉じる関数（グローバル）
        function closeOpeningModal() {
            const overlay = document.getElementById('opening-modal-overlay');
            if(overlay) {
                overlay.style.transition = "opacity 1s ease";
                overlay.style.opacity = "0";
                setTimeout(() => {
                    overlay.style.display = "none";
                }, 1000);
            }
        }

        document.addEventListener('DOMContentLoaded', () => {
            // イベントリスナー登録（ID経由）
            const startBtn = document.getElementById('opening-start-btn');
            if(startBtn) {
                startBtn.addEventListener('click', closeOpeningModal);
            }

            const canvas = document.getElementById('world');
            const ctx = canvas.getContext('2d');
            let width, height;
            let animationId;
            const config = { rainCount: 200, rainSpeed: 15, fogDensity: 20, beamSpeed: 0.015 };
            let raindrops = [], fogParticles = [], beamAngle = 0;

            function resize() { width = canvas.width = window.innerWidth; height = canvas.height = window.innerHeight; initParticles(); }
            function initParticles() {
                raindrops = []; for(let i=0; i<config.rainCount; i++) raindrops.push({x:Math.random()*width, y:Math.random()*height, l:Math.random()*20+10, v:Math.random()*5+config.rainSpeed});
                fogParticles = []; for(let i=0; i<config.fogDensity; i++) fogParticles.push({x:Math.random()*width, y:height-Math.random()*(height*0.5), r:Math.random()*100+50, dx:(Math.random()-0.5)*0.5, alpha:Math.random()*0.08});
            }
            function animate() {
                ctx.clearRect(0, 0, width, height); drawLighthouseBeam(); drawRain(); drawFog(); drawNoise();
                animationId = requestAnimationFrame(animate);
            }
            function drawLighthouseBeam() {
                beamAngle += config.beamSpeed;
                const cx = width * 0.7, cy = height * 0.4, beamLength = Math.max(width, height) * 1.5;
                ctx.save(); ctx.translate(cx, cy); ctx.rotate(beamAngle);
                const gradient = ctx.createLinearGradient(0, 0, beamLength, 0);
                gradient.addColorStop(0, 'rgba(255, 255, 230, 0.4)'); gradient.addColorStop(0.1, 'rgba(255, 255, 230, 0.15)'); gradient.addColorStop(1, 'rgba(0, 0, 0, 0)');
                ctx.beginPath(); ctx.moveTo(0, 0); ctx.lineTo(beamLength, -150); ctx.lineTo(beamLength, 150); ctx.closePath();
                ctx.fillStyle = gradient; ctx.globalCompositeOperation = 'screen'; ctx.shadowBlur = 30; ctx.shadowColor = "rgba(255, 255, 255, 0.1)"; ctx.fill();
                ctx.rotate(Math.PI); ctx.beginPath(); ctx.moveTo(0, 0); ctx.lineTo(beamLength*0.5, -50); ctx.lineTo(beamLength*0.5, 50); ctx.closePath();
                ctx.fillStyle = 'rgba(255, 255, 255, 0.03)'; ctx.fill(); ctx.restore(); ctx.globalCompositeOperation = 'source-over';
            }
            function drawRain() {
                ctx.strokeStyle = 'rgba(200, 210, 230, 0.2)'; ctx.lineWidth = 1; ctx.beginPath();
                for(let d of raindrops) { ctx.moveTo(d.x, d.y); ctx.lineTo(d.x-2, d.y+d.l); d.y+=d.v; d.x-=0.5; if(d.y>height){d.y=-d.l; d.x=Math.random()*width;} if(d.x<0)d.x=width; }
                ctx.stroke();
            }
            function drawFog() {
                for(let f of fogParticles) {
                    ctx.beginPath(); const g=ctx.createRadialGradient(f.x,f.y,0,f.x,f.y,f.r); g.addColorStop(0,`rgba(200,200,200,${f.alpha})`); g.addColorStop(1,'rgba(0,0,0,0)');
                    ctx.fillStyle=g; ctx.arc(f.x,f.y,f.r,0,Math.PI*2); ctx.fill(); f.x+=f.dx; if(f.x-f.r>width)f.x=-f.r; if(f.x+f.r<0)f.x=width+f.r;
                }
            }
            function drawNoise() { ctx.fillStyle="rgba(255,255,255,0.03)"; for(let i=0;i<40;i++) ctx.fillRect(Math.random()*width, Math.random()*height, 2, 2); }
            window.addEventListener('resize', resize); resize(); animate();

            /* --- ギミック関連 --- */
            let moonClickCount = 0;
            const moon = document.getElementById('secret-moon');
            const ancientOverlay = document.getElementById('ancient-document-overlay');
            const flashEffect = document.getElementById('flash-effect');

            if(moon) {
                moon.addEventListener('click', () => {
                    moonClickCount++;
                    if (moonClickCount < 3) {
                        moon.style.opacity = "0.5"; setTimeout(() => moon.style.opacity = "1", 200);
                    } else {
                        moon.classList.add('moon-active');
                        setTimeout(() => { flashEffect.style.opacity = "1"; }, 500);
                        setTimeout(() => {
                            ancientOverlay.classList.add('active');
                            moonClickCount = 0; moon.classList.remove('moon-active');
                            setTimeout(() => { flashEffect.style.opacity = "0"; }, 500);
                        }, 2500);
                    }
                });
            }
            
            // 古文書モーダルを閉じる関数（グローバルスコープ用）
            window.closeOverlay = function() { ancientOverlay.classList.remove('active'); }

            /* --- アイテム拡大モーダル機能 --- */
            const detailOverlay = document.getElementById('detail-modal-overlay');
            const detailContent = document.getElementById('detail-content-area');

            window.openDetailModal = function(element) {
                const clone = element.cloneNode(true);
                clone.removeAttribute('onclick'); 
                clone.classList.remove('scrap-item'); 
                clone.style.transform = "none"; // 拡大時は回転解除
                
                // 画像などは最大幅に合わせる
                clone.style.maxWidth = "100%";
                clone.style.height = "auto";

                detailContent.innerHTML = ''; 
                detailContent.appendChild(clone);
                detailOverlay.classList.add('active');
            }

            window.closeDetailModal = function() {
                detailOverlay.classList.remove('active');
            }

            // モーダル外（背景）をクリックしても閉じるようにイベントリスナーを追加
            detailOverlay.addEventListener('click', (e) => {
                if (e.target === detailOverlay || e.target === detailContent) {
                    window.closeDetailModal();
                }
            });
        });
    </script>
</body>
</html>
